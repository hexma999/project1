<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>장바구니 - 경수오빠못해조</title>
    <link
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"
      rel="stylesheet"
    />
    <link href="/static/css/common.css" rel="stylesheet" />
  </head>
  <body>
    {% include "header.html" %} {% include "navbar.html" %}

    <div class="container my-5">
      <h2 class="mb-4 font-weight-bold">
        <i class="fas fa-shopping-cart"></i> 장바구니
      </h2>

      <div class="row">
        <div class="col-lg-8">
          {% if cart_items %}
          <div class="card shadow-sm border-0">
            <div class="card-body p-0">
              <table class="table table-hover mb-0">
                <thead class="bg-light">
                  <tr>
                    <th class="border-0">상품정보</th>
                    <th class="border-0 text-center">수량</th>
                    <th class="border-0 text-right">금액</th>
                    <th class="border-0"></th>
                  </tr>
                </thead>
                <tbody>
                  {% for item in cart_items %}
                  <tr id="row-{{ item.id }}">
                    <td class="align-middle">
                      <div class="d-flex align-items-center">
                        <img
                          src="{{ item.image_url }}"
                          style="
                            width: 60px;
                            height: 60px;
                            object-fit: cover;
                            border-radius: 8px;
                            margin-right: 15px;
                          "
                        />
                        <div>
                          <a
                            href="/products/{{ item.product_id }}"
                            class="text-dark font-weight-bold"
                            >{{ item.name }}</a
                          >
                          <div class="small text-muted">{{ item.price }}원</div>
                        </div>
                      </div>
                    </td>
                    <td class="align-middle text-center">
                      <span class="badge badge-light border"
                        >{{ item.quantity }}개</span
                      >
                    </td>
                    <td
                      class="align-middle text-right font-weight-bold text-danger"
                    >
                      {{ item.sub_total }}원
                    </td>
                    <td class="align-middle text-right">
                      <button
                        class="btn btn-sm btn-outline-secondary border-0"
                        onclick="removeItem({{ item.id }})"
                      >
                        <i class="fas fa-times"></i>
                      </button>
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
          {% else %}
          <div class="text-center py-5 bg-white rounded shadow-sm">
            <i class="fas fa-shopping-basket fa-4x text-muted mb-3"></i>
            <p class="text-muted">장바구니가 비어있습니다.</p>
            <a href="/" class="btn btn-danger rounded-pill px-4"
              >쇼핑하러 가기</a
            >
          </div>
          {% endif %}
        </div>

        <div class="col-lg-4 mt-4 mt-lg-0">
          <div class="card shadow-sm border-0">
            <div class="card-header bg-white font-weight-bold py-3">
              결제 정보
            </div>
            <div class="card-body">
              <div class="d-flex justify-content-between mb-3">
                <span>총 상품금액</span>
                <span class="font-weight-bold">{{ total_price }}원</span>
              </div>
              <div class="d-flex justify-content-between mb-3 text-muted">
                <span>배송비</span>
                <span>무료</span>
              </div>
              <hr />
              <div class="d-flex justify-content-between mb-4">
                <span class="h5 font-weight-bold">총 결제금액</span>
                <span class="h5 font-weight-bold text-danger"
                  >{{ total_price }}원</span
                >
              </div>
              <button
                class="btn btn-block btn-danger py-3 font-weight-bold"
                onclick="checkout()"
                {%
                if
                not
                cart_items
                %}disabled{%
                endif
                %}
              >
                구매하기
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      function removeItem(itemId) {
        if (!confirm("삭제하시겠습니까?")) return;
        fetch("/cart/remove/" + itemId, { method: "DELETE" })
          .then((res) => res.json())
          .then((data) => {
            if (data.result === "success") location.reload();
          });
      }

      function checkout() {
        if (!confirm("장바구니의 모든 상품을 구매하시겠습니까?")) return;
        fetch("/cart/checkout", { method: "POST" })
          .then((res) => res.json())
          .then((data) => {
            alert(data.message);
            if (data.result === "success") location.href = "/mypage";
          });
      }
    </script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
  </body>
</html>
