{% extends "base.html" %} {% block title %}{{ product.name }} - 경수오빠못해조{%
endblock %} {% block css %}
<link href="/static/css/product_detail.css" rel="stylesheet" />
{% endblock %} {% block content %}
<div class="container mb-5">
  <div class="product-detail-card">
    <div class="row">
      <div class="col-md-6 mb-4">
        <div class="detail-img-wrapper">
          <img
            src="{{ product.image_url if product.image_url else 'https://via.placeholder.com/400' }}"
            alt="{{ product.name }}"
            class="product-img"
          />
        </div>
      </div>

      <div class="col-md-6">
        <span class="badge-category">{{ product.category | upper }}</span>
        <h1 class="product-title">{{ product.name }}</h1>
        <p class="product-brand">{{ product.brand }}</p>
        <hr style="border-top: 1px dashed #ddd; margin: 25px 0" />

        <p class="product-price">{{ product.price }}원</p>

        <div class="quantity-control">
          <span class="mr-3 text-muted font-weight-bold">수량</span>
          <button class="qty-btn" type="button" id="btnMinus">
            <i class="fas fa-minus"></i>
          </button>
          <input
            type="text"
            class="qty-input"
            value="1"
            id="quantityInput"
            readonly
          />
          <button class="qty-btn" type="button" id="btnPlus">
            <i class="fas fa-plus"></i>
          </button>
        </div>

        <button
          class="btn btn-lg btn-outline-danger btn-block mb-2"
          onclick="addToCart({{ product.id }})"
        >
          <i class="fas fa-shopping-cart"></i> 장바구니 담기
        </button>
        <button
          class="btn btn-lg btn-danger btn-block"
          onclick="buyItem({{ product.id }})"
        >
          구매하기
        </button>
      </div>
    </div>

    <div class="mt-5 pt-4">
      <ul class="nav nav-tabs mb-4" id="myTab" role="tablist">
        <li class="nav-item">
          <a
            class="nav-link active font-weight-bold text-dark"
            id="detail-tab"
            data-toggle="tab"
            href="#detail"
            role="tab"
            >상세 정보</a
          >
        </li>
        <li class="nav-item">
          <a
            class="nav-link font-weight-bold text-dark"
            id="review-tab"
            data-toggle="tab"
            href="#review"
            role="tab"
          >
            구매 후기
            <span class="badge badge-warning ml-1">{{ reviews|length }}</span>
          </a>
        </li>
      </ul>

      <div class="tab-content" id="myTabContent">
        <div class="tab-pane fade show active" id="detail" role="tabpanel">
          <div class="detail-content-box">
            {% if product.detail %}
            <ul class="detail-list">
              {% for info in product.detail.split(' | ') %} {% set clean_info =
              info.strip() %} {% if clean_info != '' and not
              clean_info.startswith("도그팡") and not
              clean_info.startswith("캣팡")%}
              <li>
                <i class="fas fa-check-circle text-danger mr-2"></i>{{
                clean_info }}
              </li>
              {% endif %} {% endfor %}
            </ul>
            {% else %}
            <div class="text-center py-5 text-muted">
              <i
                class="fas fa-clipboard-list fa-3x mb-3"
                style="opacity: 0.3"
              ></i
              ><br />
              상세 설명이 준비 중입니다.
            </div>
            {% endif %}

            <hr style="border-top: 2px dashed #eee; margin: 30px 0" />

            {% if product.detail_img_url %}
            <div class="detail-image-wrapper text-center mb-4">
              <img
                src="{{ product.detail_img_url }}"
                alt="상세 정보 이미지"
                class="img-fluid rounded"
                style="max-width: 100%; height: auto"
              />
            </div>
            {% endif %}
          </div>
        </div>

        <div class="tab-pane fade" id="review" role="tabpanel">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="font-weight-bold m-0">리뷰 리스트</h5>
            <button
              class="btn btn-sm btn-warning font-weight-bold"
              onclick="openReviewModal()"
            >
              <i class="fas fa-pen"></i> 리뷰 쓰기
            </button>
          </div>
          <div class="review-list">
            {% for review in reviews %}
            <div class="review-card">
              <div
                class="d-flex justify-content-between align-items-center mb-2"
              >
                <div class="review-user">
                  <i class="fas fa-user-circle"></i> {{ review.username }}
                </div>
                <span class="review-date"
                  >{{ review.created_at.strftime('%Y-%m-%d') }}</span
                >
              </div>
              <p class="review-text">{{ review.content }}</p>
            </div>
            {% else %}
            <div class="text-center py-5 bg-light rounded border">
              <i
                class="far fa-comment-dots fa-3x text-muted mb-3"
                style="opacity: 0.5"
              ></i>
              <p class="text-muted font-weight-bold">
                아직 작성된 후기가 없습니다.<br />첫 번째 후기의 주인공이
                되어보세요!
              </p>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="floating-buttons">
  <button
    class="float-btn btn-review"
    onclick="openReviewModal()"
    title="리뷰 쓰기"
  >
    <i class="fas fa-pen"></i>
  </button>
  <button class="float-btn btn-top" onclick="scrollToTop()" title="맨 위로">
    <i class="fas fa-arrow-up"></i>
  </button>
</div>

<div id="reviewModal" class="modal-overlay">
  <div class="review-modal">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h4 class="font-weight-bold m-0">
        <i class="fas fa-comment-dots text-warning"></i> 리뷰 작성
      </h4>
      <button class="close" onclick="closeReviewModal()">&times;</button>
    </div>
    <p class="text-muted small">이 상품에 대한 솔직한 의견을 남겨주세요.</p>
    <div class="form-group">
      <textarea
        id="reviewContent"
        class="form-control bg-light border-0"
        rows="5"
        placeholder="예: 배송도 빠르고 강아지가 너무 좋아해요!"
        style="resize: none"
      ></textarea>
    </div>
    <div class="text-right mt-4">
      <button
        class="btn btn-light mr-2 font-weight-bold"
        onclick="closeReviewModal()"
      >
        취소
      </button>
      <button
        class="btn btn-warning font-weight-bold px-4"
        onclick="submitReview({{ product.id }})"
      >
        등록하기
      </button>
    </div>
  </div>
</div>
{% endblock %} {% block scripts %}
<script src="/static/js/product_detail.js"></script>
{% endblock %}
