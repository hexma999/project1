<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>경수오빠못해조 - 시작하기</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      /* --- 공통 스타일 --- */
      body {
        font-family: "Noto Sans KR", sans-serif;
        background: #f0f2f5;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        margin: 0;
        padding: 20px;
        box-sizing: border-box;
      }

      .container {
        background-color: #fff;
        border-radius: 24px; /* 더 부드러운 둥근 모서리 */
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.08);
        width: 100%;
        max-width: 440px; /* 너비 살짝 넓힘 */
        padding: 50px 40px; /* 내부 여백 넉넉하고 균일하게 */
        box-sizing: border-box;
        text-align: center;
        position: relative;
        overflow: hidden;
      }

      /* 타이틀 영역 */
      h1 {
        color: #e74c3c;
        margin: 0 0 12px 0;
        font-weight: 800;
        font-size: 1.8rem;
        letter-spacing: -0.5px;
      }
      .subtitle {
        color: #95a5a6;
        font-size: 0.95rem;
        margin-bottom: 35px;
        font-weight: 500;
      }

      /* 폼 그룹 */
      .form-group {
        margin-bottom: 20px; /* 간격 넓힘 */
        text-align: left;
      }
      .form-group label {
        display: block;
        margin-bottom: 8px;
        color: #34495e;
        font-weight: 700;
        font-size: 0.9rem;
        padding-left: 5px; /* 라벨 살짝 들여쓰기 */
      }

      /* 입력창 스타일 (일관성 강화) */
      .form-control {
        width: 100%;
        height: 50px; /* 높이 고정 */
        padding: 0 15px; /* 좌우 패딩 */
        border: 1px solid #e0e0e0;
        border-radius: 12px;
        font-size: 1rem;
        color: #333;
        background-color: #f9f9f9;
        transition: all 0.2s ease;
        box-sizing: border-box; /* 패딩 포함 크기 계산 */
      }
      .form-control:focus {
        border-color: #e74c3c;
        background-color: #fff;
        outline: none;
        box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.1);
      }
      .form-control::placeholder {
        color: #bdc3c7;
      }

      /* 아이디 중복확인 래퍼 */
      .input-wrapper {
        position: relative;
        width: 100%;
      }
      /* 중복확인 버튼이 있는 입력창은 오른쪽 패딩을 더 줌 */
      .input-wrapper .form-control {
        padding-right: 95px;
      }

      /* 중복 확인 버튼 */
      .btn-check {
        position: absolute;
        right: 6px;
        top: 6px;
        bottom: 6px;
        width: 85px;
        background-color: #2c3e50;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 0.8rem;
        font-weight: 600;
        cursor: pointer;
        transition: 0.2s;
      }
      .btn-check:hover {
        background-color: #34495e;
      }
      .btn-check.checked {
        background-color: #27ae60;
        cursor: default;
      }

      /* 메인 버튼 (로그인/가입) */
      .btn-submit {
        width: 100%;
        height: 54px; /* 입력창보다 살짝 크게 */
        background-color: #e74c3c;
        color: white;
        border: none;
        border-radius: 12px;
        font-size: 1.1rem;
        font-weight: 700;
        cursor: pointer;
        margin-top: 10px;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
      }
      .btn-submit:hover {
        background-color: #c0392b;
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
      }

      /* 하단 링크 영역 */
      .toggle-box {
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid #f1f1f1;
        font-size: 0.95rem;
        color: #7f8c8d;
      }
      .toggle-link {
        color: #e74c3c;
        font-weight: 700;
        cursor: pointer;
        text-decoration: none;
        margin-left: 5px;
      }
      .toggle-link:hover {
        text-decoration: underline;
      }

      /* 유틸리티 & 애니메이션 */
      .hidden {
        display: none;
      }
      .fade-in {
        animation: fadeIn 0.4s ease-out;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* 에러/성공 메시지 */
      .msg-text {
        font-size: 0.8rem;
        margin-top: 6px;
        display: block;
        padding-left: 5px;
        font-weight: 500;
      }
      .msg-error {
        color: #e74c3c;
      }
      .msg-success {
        color: #27ae60;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div id="login-box" class="fade-in">
        <h1><i class="fas fa-paw"></i> 경수오빠못해조</h1>
        <p class="subtitle">반려동물을 위한 모든 것이 여기에!</p>

        <form id="loginForm" onsubmit="submitLoginForm(event)">
          <div class="form-group">
            <label>아이디</label>
            <input
              type="text"
              name="username"
              class="form-control"
              placeholder="아이디를 입력하세요"
              required
            />
          </div>
          <div class="form-group">
            <label>비밀번호</label>
            <input
              type="password"
              name="password"
              class="form-control"
              placeholder="비밀번호를 입력하세요"
              required
            />
          </div>
          <button type="submit" class="btn-submit">로그인 하기</button>
        </form>

        <div class="toggle-box">
          아직 계정이 없으신가요?
          <span class="toggle-link" onclick="toggleForms()">회원가입</span>
        </div>
      </div>

      <div id="signup-box" class="hidden">
        <h1>회원가입</h1>
        <p class="subtitle">필수 정보를 입력하고 바로 시작하세요</p>

        <form id="signupForm" onsubmit="return false;">
          <div class="form-group">
            <label>아이디</label>
            <div class="input-wrapper">
              <input
                type="text"
                id="su_username"
                class="form-control"
                placeholder="영문, 숫자 포함"
                oninput="resetIdCheck()"
              />
              <button
                type="button"
                class="btn-check"
                id="btn-id-check"
                onclick="checkId()"
              >
                중복확인
              </button>
            </div>
            <small id="id-msg" class="msg-text"></small>
          </div>

          <div class="form-group">
            <label>비밀번호</label>
            <input
              type="password"
              id="su_password"
              class="form-control"
              placeholder="비밀번호 입력"
            />
          </div>
          <div class="form-group">
            <label>비밀번호 확인</label>
            <input
              type="password"
              id="su_password_confirm"
              class="form-control"
              placeholder="한 번 더 입력해주세요"
              oninput="checkPwMatch()"
            />
            <small id="pw-msg" class="msg-text msg-error"></small>
          </div>

          <div class="row" style="display: flex; gap: 15px">
            <div class="form-group" style="flex: 2">
              <label>생년월일</label>
              <input
                type="date"
                id="su_birthdate"
                class="form-control"
                style="padding-right: 10px"
              />
            </div>
            <div class="form-group" style="flex: 1">
              <label>성별</label>
              <select
                id="su_gender"
                class="form-control"
                style="padding: 0 10px"
              >
                <option value="">선택</option>
                <option value="M">남성</option>
                <option value="F">여성</option>
                <option value="N">기타</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label>휴대폰 번호</label>
            <input
              type="tel"
              id="su_phone"
              class="form-control"
              placeholder="010-0000-0000"
              maxlength="13"
              oninput="autoHyphen(this)"
            />
          </div>

          <div class="form-group">
            <label>이메일</label>
            <input
              type="email"
              id="su_email"
              class="form-control"
              placeholder="example@email.com"
            />
          </div>

          <button type="button" class="btn-submit" onclick="submitSignup()">
            가입 완료
          </button>
        </form>

        <div class="toggle-box">
          이미 계정이 있으신가요?
          <span class="toggle-link" onclick="toggleForms()">로그인</span>
        </div>
      </div>
    </div>

    <script>
      // --- 화면 전환 ---
      function toggleForms() {
        const loginBox = document.getElementById("login-box");
        const signupBox = document.getElementById("signup-box");

        if (loginBox.classList.contains("hidden")) {
          loginBox.classList.remove("hidden");
          signupBox.classList.add("hidden");
        } else {
          loginBox.classList.add("hidden");
          signupBox.classList.remove("hidden");
          // 폼 초기화
          document.getElementById("signupForm").reset();
          resetIdCheck();
          document.getElementById("pw-msg").innerText = "";
        }
      }

      // --- 아이디 중복 확인 ---
      let isIdChecked = false;

      function checkId() {
        const username = document.getElementById("su_username").value;
        const msgBox = document.getElementById("id-msg");
        const btn = document.getElementById("btn-id-check");

        if (!username) {
          alert("아이디를 입력해주세요.");
          return;
        }

        fetch("/auth/check-id", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ username: username }),
        }).then((res) => {
          if (res.status === 200) {
            msgBox.innerText = "사용 가능한 아이디입니다.";
            msgBox.className = "msg-text msg-success";
            isIdChecked = true;
            btn.innerText = "확인완료";
            btn.classList.add("checked");
          } else {
            msgBox.innerText = "이미 사용 중인 아이디입니다.";
            msgBox.className = "msg-text msg-error";
            isIdChecked = false;
          }
        });
      }

      function resetIdCheck() {
        isIdChecked = false;
        const msgBox = document.getElementById("id-msg");
        const btn = document.getElementById("btn-id-check");
        msgBox.innerText = "";
        btn.innerText = "중복확인";
        btn.classList.remove("checked");
      }

      // --- 비밀번호 일치 확인 ---
      function checkPwMatch() {
        const pw = document.getElementById("su_password").value;
        const pwConfirm = document.getElementById("su_password_confirm").value;
        const msgBox = document.getElementById("pw-msg");

        if (pw && pwConfirm && pw !== pwConfirm) {
          msgBox.innerText = "비밀번호가 일치하지 않습니다.";
        } else {
          msgBox.innerText = "";
        }
      }

      // --- 전화번호 자동 하이픈 ---
      function autoHyphen(target) {
        target.value = target.value
          .replace(/[^0-9]/g, "")
          .replace(/^(\d{0,3})(\d{0,4})(\d{0,4})$/g, "$1-$2-$3")
          .replace(/(\-{1,2})$/g, "");
      }

      // --- 최종 가입 요청 ---
      function submitSignup() {
        if (!isIdChecked) {
          alert("아이디 중복 확인을 해주세요.");
          document.getElementById("su_username").focus();
          return;
        }

        const username = document.getElementById("su_username").value;
        const password = document.getElementById("su_password").value;
        const pwConfirm = document.getElementById("su_password_confirm").value;
        const birthdate = document.getElementById("su_birthdate").value;
        const gender = document.getElementById("su_gender").value;
        const phone = document.getElementById("su_phone").value;
        const email = document.getElementById("su_email").value;

        if (
          !username ||
          !password ||
          !birthdate ||
          !gender ||
          !phone ||
          !email
        ) {
          alert("모든 정보를 입력해주세요.");
          return;
        }
        if (password !== pwConfirm) {
          alert("비밀번호가 일치하지 않습니다.");
          return;
        }

        const data = {
          username: username,
          password: password,
          birthdate: birthdate,
          gender: gender,
          phone_number: phone,
          email: email,
        };

        fetch("/auth/signup", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data),
        })
          .then((response) =>
            response
              .json()
              .then((body) => ({ status: response.status, body: body }))
          )
          .then((result) => {
            if (result.status === 200) {
              alert("가입을 축하합니다! 로그인해주세요.");
              toggleForms();
            } else {
              alert(result.body.detail || "가입 실패");
            }
          })
          .catch((err) => console.error(err));
      }

      // --- 로그인 요청 ---
      function submitLoginForm(event) {
        event.preventDefault();
        const formData = new FormData(event.target);
        const data = Object.fromEntries(formData.entries());

        fetch("/auth/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data),
        })
          .then((res) =>
            res.json().then((body) => ({ status: res.status, body: body }))
          )
          .then((result) => {
            if (result.status === 200) {
              window.location.href = "/";
            } else {
              alert(result.body.detail || "로그인 실패");
            }
          });
      }
    </script>
  </body>
</html>
